(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{130:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return c})),a.d(t,"metadata",(function(){return l})),a.d(t,"rightToc",(function(){return p})),a.d(t,"default",(function(){return b}));var n=a(2),r=a(6),o=(a(0),a(144)),i=a(145),c={id:"micResSerPosSQL",title:"Java Micronaut REST Server with PostgreSQL"},l={id:"javMicExa/micResSerPosSQL",isDocsHomePage:!1,title:"Java Micronaut REST Server with PostgreSQL",description:"Time: 45 minutes",source:"@site/docs\\javMicExa\\javaMicronautRestServerWithPostrgeSql.mdx",permalink:"/code_now/docs/javMicExa/micResSerPosSQL",editUrl:"https://github.com/VitSestak/code_now/docs/javMicExa/javaMicronautRestServerWithPostrgeSql.mdx",sidebar:"Docs",previous:{title:"Java Micronaut REST Server with Redis and Kafka",permalink:"/code_now/docs/javMicExa/micResSerRedAndKaf"},next:{title:"Java Micronaut REST API",permalink:"/code_now/docs/javMicExa/micResApi"}},p=[{value:"What you\u2019ll learn",id:"what-youll-learn",children:[]},{value:"Project source",id:"project-source",children:[]},{value:"Before you begin",id:"before-you-begin",children:[]},{value:"Steps",id:"steps",children:[]},{value:"What\u2019s next?",id:"whats-next",children:[]}],s={rightToc:p};function b(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(n.a)({},s,a,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"Time: 45 minutes"),Object(o.b)("h2",{id:"what-youll-learn"},"What you\u2019ll learn"),Object(o.b)("p",null,"How to setup your application for : "),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"connecting to PostgreSQL database,"),Object(o.b)("li",{parentName:"ul"},"getting data from REST API, "),Object(o.b)("li",{parentName:"ul"},"providing data to REST API. ")),Object(o.b)("p",null,"In this tutorial, we will create a simple java component with Java Micronaut Data scaffolder with connection to PostgreSQL database storage. We want to expose single REST endpoint for getting basic client data information, creating a microservice CRUD layer above DB storage."),Object(o.b)("img",{alt:"clientDataDB",src:Object(i.a)("img/javMicExa/javaMicronautRestServerWithPostgreSql/ClientDataDB.png")}),Object(o.b)("h2",{id:"project-source"},"Project source"),Object(o.b)("p",null,"This example project can be cloned from: ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"mailto:git@gitlab.factory.innobank.codenow.com"}),"git@gitlab.factory.innobank.codenow.com"),":innobank/client-data-db.git"),Object(o.b)("h2",{id:"before-you-begin"},"Before you begin"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Prepare your local development environment for CodeNOW with Micronaut. ",Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"Follow the tutorial instructions in ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://www.codenow.com/docs/local-development-with-codenow/java-micronaut-local-development/"}),"Java Micronaut Local Development")," tutorial."))),Object(o.b)("li",{parentName:"ul"},"Run PostgreSQL locally. ",Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"Use docker compose as described in the section ",Object(o.b)("em",{parentName:"li"},"Docker compose and third-party tools")," of the ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://www.codenow.com/docs/local-development-with-codenow/java-micronaut-local-development/"}),"Java Micronaut Local Development")," tutorial. "))),Object(o.b)("li",{parentName:"ul"},"Create a new component",Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"For details see the section ",Object(o.b)("em",{parentName:"li"},"Prerequisites")," of the ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://www.codenow.com/docs/local-development-with-codenow/java-micronaut-local-development/"}),"Java Micronaut Local Development")," tutorial.")))),Object(o.b)("h2",{id:"steps"},"Steps"),Object(o.b)("p",null,"Open your IDE, import created component and start coding:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Define jpa entity Client. This simple table will store basic client data:"),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Generate getters and setters with your IDE"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-java"}),"01  package io.codenow.client.data.db.service.repository.entity;\n02   \n03  import java.time.LocalDate;\n04 \n05  import javax.persistence.Entity;\n06  import javax.persistence.GeneratedValue;\n07  import javax.persistence.Id;\n08 \n09  @Entity\n10  public class Client {\n11      @Id\n12      @GeneratedValue\n13      private Long id;\n14 \n15      private String username;\n16      private String firstname;\n17      private String surname;\n18      private LocalDate birthdate;\n19  }\n"))))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Create new ClientRepository, which is basic CRUD interface for micronaut data DB access:"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-java"}),"01  package io.codenow.client.data.db.service.repository;\n02   \n03  import io.codenow.client.data.db.service.repository.entity.Client;\n04  import io.micronaut.data.jdbc.annotation.JdbcRepository;\n05  import io.micronaut.data.repository.CrudRepository;\n06  import io.reactivex.Maybe;\n07 \n08 \n09  @JdbcRepository\n10  public interface ClientRepository extends CrudRepository<Client, Long> {\n11      Maybe<Client> findByUsername(String username);\n12  }\n"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Create new controller and put all parts together"),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"More detail about Micronaut controller:  ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://docs.micronaut.io/latest/guide/index.html#httpServer"}),"https://docs.micronaut.io/latest/guide/index.html#httpServer")),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-java"}),'01  package io.codenow.client.data.db.service.controller;\n02 \n03  import javax.inject.Inject;\n04  import javax.validation.constraints.NotNull;\n05 \n06  import io.codenow.client.data.db.service.repository.ClientRepository;\n07  import io.codenow.client.data.db.service.repository.entity.Client;\n08  import io.micronaut.http.annotation.Consumes;\n09  import io.micronaut.http.annotation.Controller;\n10  import io.micronaut.http.annotation.Get;\n11  import io.micronaut.http.annotation.PathVariable;\n12  import io.micronaut.http.annotation.Produces;\n13  import io.micronaut.validation.Validated;\n14  import io.reactivex.Flowable;\n15  import io.reactivex.Maybe;\n16 \n17  /**\n18   * ClientDataController.\n19   */\n20  @Validated\n21  @Controller("/db")\n22  @Produces\n23  @Consumes\n24  public class ClientDataController {\n25 \n26      private final ClientRepository clientRepository;\n27   \n28      @Inject\n29      public ClientDataController(ClientRepository bookRepository) {\n30          this.clientRepository = bookRepository;\n31      }\n32 \n33      @Get("/clients")\n34      public Flowable<Client> listClients() {\n35          return Flowable.fromIterable(clientRepository.findAll());\n36      }\n37 \n38      @Get("/clients/{username}")\n39      public Maybe<Client> getClient(@PathVariable @NotNull String username) {\n40          return clientRepository.findByUsername(username);\n41 \n42      }\n43 \n44  }\n'))))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Next prepare database configuration:"),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Go to PgAdmin console (",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"http://localhost:5050"}),"http://localhost:5050")," if using compose-postgre from our Local development manual) and create new db client-db with scheme ",Object(o.b)("strong",{parentName:"p"},"client-data"),".")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Add maven dependency to your pom.xml"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-java"}),"01  <dependency>\n02      <groupId>org.postgresql</groupId>\n03      <artifactId>postgresql</artifactId>\n04      <version>42.2.11</version>\n05  </dependency>\n"))))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Now change configuration in ",Object(o.b)("em",{parentName:"p"},"config/application.yaml"),":")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Fill {db user} and {db password} according to your configuration")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Make sure you follow yaml syntax (especially whitespaces)"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-java"}),"01  datasources:\n02    default:\n03      url: jdbc:postgresql://localhost:5432/client-db?currentSchema=client-data\n04      driverClassName: org.postgresql.Driver\n05      username: {db user}\n06      password: {db password}\n07      schema-generate: CREATE\n08    dialect: POSTGRES\n"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Do not forget to change swagger.yaml. Check it in example project: ",Object(o.b)("em",{parentName:"p"},"src/main/resources/META-INF/swagger/swagger.yaml"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Try to build and run the application in your IDE. After startup, you should be able to access your new controller\u2019s swagger: ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"http://localhost:8080/swagger/index.html"}),"http://localhost:8080/swagger/index.html")),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"For correct setup, check Readme.md in project root or see tutorial ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://www.codenow.com/docs/local-development-with-codenow/java-micronaut-local-development/"}),"Java Micronaut Local Development"),", section ",Object(o.b)("em",{parentName:"li"},"Prepare local development IDE"))))),Object(o.b)("img",{alt:"clientDataDBSwagger",src:Object(i.a)("img/javMicExa/javaMicronautRestServerWithPostgreSql/clientDataDB_swagger.png")}),Object(o.b)("h2",{id:"whats-next"},"What\u2019s next?"),Object(o.b)("p",null,"If your code works in the local development, you are ready to push your changes to GIT and try to build and deploy your new component version to the CodeNOW environment. For more information see ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.codenow.com/docs/administration-manuals/deploy-application/"}),"Application Deployment")," and ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.codenow.com/docs/administration-manuals/deployment-monitoring/"}),"Monitoring"),", just make sure to ",Object(o.b)("strong",{parentName:"p"},"change the application.yaml properties from the local to the production setup.")),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Check the ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://accounts.google.com/signin/v2/identifier?continue=https%3A%2F%2Fdrive.google.com%2Fa%2Fstratox.cz%2Fopen%3Fid%3D1lgWTgsGxnYmgJqqq21htQjJZ-QrJsgSAnkcGscd_GGE&service=wise&hd=stratox.cz&sacu=1&flowName=GlifWebSignIn&flowEntry=AddSession"}),"Get New PostgreSQL")," user manual to get CodeNOW managed component properties. "),Object(o.b)("li",{parentName:"ul"},"See tutorial ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://www.codenow.com/docs/java-micronaut-examples/java-micronaut-rest-server-with-redis-and-kafka/"}),"Micronaut REST server with Redis and Kafka"),".")))}b.isMDXComponent=!0},143:function(e,t,a){"use strict";var n=a(0),r=a(35);t.a=function(){return Object(n.useContext)(r.a)}},144:function(e,t,a){"use strict";a.d(t,"a",(function(){return b})),a.d(t,"b",(function(){return d}));var n=a(0),r=a.n(n);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=r.a.createContext({}),s=function(e){var t=r.a.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):c(c({},t),e)),a},b=function(e){var t=s(e.components);return r.a.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},m=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,i=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),b=s(a),m=n,d=b["".concat(i,".").concat(m)]||b[m]||u[m]||o;return a?r.a.createElement(d,c(c({ref:t},p),{},{components:a})):r.a.createElement(d,c({ref:t},p))}));function d(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,i=new Array(o);i[0]=m;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:n,i[1]=c;for(var p=2;p<o;p++)i[p]=a[p];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,a)}m.displayName="MDXCreateElement"},145:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(143),r=a(146);function o(e,{forcePrependBaseUrl:t=!1,absolute:a=!1}={}){const{siteConfig:{baseUrl:o="/",url:i}={}}=Object(n.a)();if(!e)return e;if(t)return o+e;if(!Object(r.a)(e))return e;const c=o+e.replace(/^\//,"");return a?i+c:c}},146:function(e,t,a){"use strict";function n(e){return!1===/^(https?:|\/\/|mailto:|tel:)/.test(e)}a.d(t,"a",(function(){return n}))}}]);